{"ast":null,"code":"import _classCallCheck from \"/Users/chengang/Desktop/d3-demo/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/chengang/Desktop/d3-demo/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/chengang/Desktop/d3-demo/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/chengang/Desktop/d3-demo/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/chengang/Desktop/d3-demo/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/chengang/Desktop/d3-demo/src/App.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nvar num = [[{\n  \"number\": 1,\n  \"name\": \"one\"\n}, {\n  \"number\": 2,\n  \"name\": \"two\"\n}, {\n  \"number\": 3,\n  \"name\": \"three\"\n}]];\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n    _this.state = {\n      data: []\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      setInterval(function () {\n        fetch('http://localhost:8080').then(function (req) {\n          return req.json();\n        }).then(function (res) {\n          _this2.setState({\n            data: res.data\n          }, function () {\n            num.push(_this2.state.data);\n\n            _this2.drawChart();\n          });\n        });\n      }, 2000);\n    }\n  }, {\n    key: \"drawChart\",\n    value: function drawChart() {\n      var _this3 = this;\n\n      var width = 400,\n          height = 400;\n      var svg = d3.select('svg').attr('width', width).attr('height', height);\n      svg.selectAll('*').remove();\n      var outerRadius = 150,\n          innerRadius = 0;\n      var arc = d3.arc().innerRadius(innerRadius).outerRadius(outerRadius);\n      var pie = d3.pie().value(function (d) {\n        return d.number;\n      }).sort(function (a, b) {\n        return a.name.localeCompare(b.name);\n      });\n      var color = d3.scaleOrdinal(d3.schemeCategory10);\n      var arcs = svg.selectAll('g').data(pie(num.shift())).enter().append('g').attr('transform', 'translate(' + width / 2 + ',' + width / 2 + \")\").attr('d', arc);\n      var path = arcs.append('path').attr('d', arc).attr('fill', function (d, i) {\n        return color(i);\n      });\n      var text = arcs.append('text').attr('class', 'text').attr('transform', function (d) {\n        return \"translate(\" + arc.centroid(d) + \")\";\n      }).text(function (d) {\n        return d.data.name;\n      }).attr('text-anchor', \"middle\").attr('font-size', '16px').attr('fill', '#000');\n      path.transition().duration(1000).attrTween('d', function (d, i) {\n        var compute = d3.interpolate(d, pie(_this3.state.data)[i]);\n        return function (t) {\n          d = compute(t);\n          return arc(d);\n        };\n      });\n      text.transition().duration(1000).attrTween('transform', function (d, i) {\n        var computed = d3.interpolate(arc.centroid(d), arc.centroid(pie(_this3.state.data)[i]));\n        return function (t) {\n          d = computed(t);\n          return \"translate(\" + d + \")\";\n        };\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"svg\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/chengang/Desktop/d3-demo/src/App.js"],"names":["React","Component","d3","num","App","props","state","data","setInterval","fetch","then","req","json","res","setState","push","drawChart","width","height","svg","select","attr","selectAll","remove","outerRadius","innerRadius","arc","pie","value","d","number","sort","a","b","name","localeCompare","color","scaleOrdinal","schemeCategory10","arcs","shift","enter","append","path","i","text","centroid","transition","duration","attrTween","compute","interpolate","t","computed"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\n\nvar num = [[{ \"number\": 1, \"name\": \"one\" }, { \"number\": 2, \"name\": \"two\" }, { \"number\": 3, \"name\": \"three\" }]];\n\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data: []\n    }\n  }\n  componentDidMount() {\n    setInterval(() => {\n      fetch('http://localhost:8080').then((req) => {\n        return req.json()\n      }).then((res) => {\n        this.setState({\n          data: res.data\n        }, () => {\n          num.push(this.state.data);\n          this.drawChart();\n        })\n      })\n    }, 2000)\n  }\n  drawChart() {\n    var width = 400, height = 400;\n    var svg = d3.select('svg').attr('width', width).attr('height', height);\n    svg.selectAll('*').remove();\n    var outerRadius = 150, innerRadius = 0;\n    var arc = d3.arc()\n      .innerRadius(innerRadius)\n      .outerRadius(outerRadius);\n\n    var pie = d3.pie().value(function (d) { return d.number }).sort(function (a, b) { return a.name.localeCompare(b.name) });\n    var color = d3.scaleOrdinal(d3.schemeCategory10);\n    var arcs = svg.selectAll('g')\n      .data(pie(num.shift()))\n      .enter()\n      .append('g')\n      .attr('transform','translate(' + (width/2) + ',' + (width/2) + \")\")\n      .attr('d',arc)\n\n    var path = arcs.append('path')\n      .attr('d', arc)\n      .attr('fill', (d, i) => {\n        return color(i)\n      })\n\n    var text = arcs.append('text')\n      .attr('class', 'text')\n      .attr('transform', (d) => {\n        return \"translate(\" + arc.centroid(d) + \")\";\n      })\n      .text((d) => {\n        return d.data.name\n      })\n      .attr('text-anchor', \"middle\")\n      .attr('font-size', '16px')\n      .attr('fill', '#000')\n\n    path.transition().duration(1000).attrTween('d', (d, i) => {\n      var compute = d3.interpolate(d, pie(this.state.data)[i]);\n      return function (t) {\n        d = compute(t);\n        return arc(d)\n      }\n    })\n\n    text.transition().duration(1000).attrTween('transform', (d, i) => {\n      var computed = d3.interpolate(arc.centroid(d), arc.centroid(pie(this.state.data)[i]))\n      return function (t) {\n        d = computed(t);\n        return \"translate(\" + d + \")\"\n      }\n    })\n\n  }\n  render() {\n    return (\n      <svg className=\"App\">\n      </svg>\n    )\n  }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}